# TuningAnalysis

'TuningAnalysis' is an automated R code used to generate graphical analysis of our paper regarding Hyperparameter tuning of Decision Trees [01].
Current version works only with data generated by our Hyperparameter tuning project ([HpTuning](https://github.com/rgmantovani/HpTuning))
but may be easily extended. The main features available are:

* comparison of different techniques when performing hyperparameter tuning of classification algorithms;
* average performance plot with statistical tests;
* average runtime plots, presenting: training, testing and optimization times;
* boxplots with the average number of iterations spent by techniques;
* hyperparameters' importance assessment through Spearman correlation and [fAnova framework](https://github.com/automl/fanova) [01].

### Installation

The installation process is via git clone. You should use the following command inside your terminal session:

```
git clone https://github.com/rgmantovani/TuningAnalysis
```

### General instructions

Classification algorithms analyzed must be in accordance with ['mlr'](https://github.com/mlr-org/mlr) R package implementation [02].
A complete list of the available learners may be found [here](http://mlr-org.github.io/mlr-tutorial/release/html/integrated_learners/).

Hyperparameter tuning results should be placed in the ```data/<algorithm.name>/results``` sub-directory.

If the required data to generate plots was not extracted before, then there must be some scripts to run.
This is also checked by the automated code, and returned to the user with instructions on how to proceed.
All of the extraction scripts require the name of the algorithm as a parameter (```<algorithm.name>```).
There is no order to run these scripts, but all of them must be executed.
The files generated by these scripts will be later read and aggregated as ```data.frame``` objects and used by the automatic analysis code.

#### A - Convergence ids

This first script will extract information regarding the convergence of the tuning techniques.
For each single job ```j = (dataset, algorithm, technique, seed)```,
it will identify how many evaluations were needed to generate the best solution. To run it:

```R
Rscript extractIds.R --algo=<algorithm.name> &
# example:
# Rscript extractIds.R --algo="classif.J48" &
```

Output will be placed in the ```data/<algorithm.name>/ids``` folder,
with one file per dataset.

#### B - Models' information

This script will extract characteristics from induced models as such as running times.
If studied models were trees, for example, it will retrieve the tree size of each assessed tree. To run it:

```R
Rscript extractModels.R --algo=<algorithm.name> &
# example:
# Rscript extractModels.R --algo="classif.J48" &
```

Output will be placed in the ```data/<algorithm.name>/models``` folder,
with one file per dataset.

#### C - Hyperparameters' correlation

This script join all the hyperparameter settings generated in a specific data domain and calculates
the Spearman correlation between all hyperparameter combinations two-by-two, and also between each single hyperparameter and
and the final assessed performance. To run it:

```R
Rscript extractCorr.R --algo=<algorithm.name> &
# example:
# Rscript extractCorr.R --algo="classif.J48" &
```
Output will be placed in the ```data/<algorithm.name>/corr``` folder,
with one file per dataset.


#### D - FAnova hyperparameter marginal predictions

FAnova marginal predictions are obtained by an [external project](https://github.com/automl/fanova). This our script will generate
input files in the pattern required by the FAnova python script. To run it:

```R
Rscript createFanovaInputs.R --algo=<algorithm.name> &
# example:
# Rscript createFanovaInputs.R --algo="classif.J48" &
```
Output will be placed in the ```data/<algorithm.name>/input_fanova``` folder,
with one file per dataset. Provide these files to the external project. It will also generate one correspondent file per dataset.
These new files, should be placed in the ```data/<algorithm.name>/fanova``` sub-directory.

### Running the code

To run the project, please, call it by the following command:
```R
 Rscript mainAnalysis.R --algo=<algorithm.name> --space=<hp.space> &
 # examples:
 # Rscript mainAnalysis.R --algo="classif.rpart" --space="reduced" &
 # Rscript mainAnalysis.R --algo="classif.rpart" --space="full" &
 # Rscript mainAnalysis.R --algo="classif.J48" --space="full" &
```
The space option specifies which hyperparameter space will be considered. There are two options: full - the complete hyperparameter space with all the tunable hyperparameters; and reduced - with a pruned hyper space based on the FAnova analysis.
For any option, the script will call the analysis and output plots (as pdfs) into the ```output``` sub-directory.

### Contact

Rafael Gomes Mantovani (rgmantovani@gmail.com) Universidade Tecnológica Federal do Paraná (UTFPR), Apucarana, Brazil.

### References

[01] F. Hutter, H. Hoos, K. Leyton-Brown. [An Efficient Approach for Assessing Hyperparameter Importance](http://jmlr.org/proceedings/papers/v32/hutter14.html).
In: *Proceedings of the 31th International Conference on Machine Learning*, ICMC 2014, Beijing, China, 2014, pgs 754-762.

[02] B. Bischl, Michel Lang, Lars Kotthoff, Julia Schiffner, Jakob Richter, Erich Studerus, Giuseppe Casalicchio, Zachary Jones.
mlr: [Machine Learning in R. Journal of Machine Learning in R](https://github.com/mlr-org/mlr), v.17, n.170, 2016, pgs 1-5.
